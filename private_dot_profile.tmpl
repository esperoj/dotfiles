#!/bin/sh
echo "Running ${HOME}/.profile"

export MACHINE_TYPE={{ .machineType | quote }}
set -a && . "${HOME}/.env" && set +a
[ ! -d "${HOME}/.asdf" ] || . "$HOME/.asdf/asdf.sh"
if [ -n "$LD_LIBRARY_PATH" ]; then
  case ":$LD_LIBRARY_PATH:" in
    *":$HOME/.local/lib:"*) ;;
    *) export LD_LIBRARY_PATH="$HOME/.local/lib:$LD_LIBRARY_PATH" ;;
  esac
else
  export LD_LIBRARY_PATH="$HOME/.local/lib"
fi

if [ "$(hostname)" = "core.envs.net" ] || [ "$(hostname)" = "de1" ]; then
    export TMPDIR="/dev/shm/esperoj"
fi
if [ "$(hostname)" = "bsd.tilde.team" ] || [ "$(hostname)" = "tilde" ]; then
    export TMPDIR="/tmp/esperoj"
fi
(
    cd ~
    if [ "${MACHINE_TYPE}" = "pubnix" ]; then
        if [ ! -d "${TMPDIR}" ]; then
            mkdir -p "${TMPDIR}"/{.cache,.npm,tmp}
            chmod 700 "${TMPDIR}"
            rm -rf .cache .npm tmp
            ln -s "${TMPDIR}"/{.cache,.npm,tmp} .
        fi
    fi
)

# Don't run code below if shell is non-interactive
case $- in
  *i*)
    if [ -z "$TMUX" ]; then
      tmux attach -t work 2>/dev/null || tmux new-session -s work
      exit
    fi
  ;;
esac
