#!/bin/bash

echo "Running ${HOME}/.profile"
. ~/.bash_aliases

export MACHINE_TYPE={{ .machineType | quote }}
set -a && . "${HOME}/.env" && set +a
[ ! -d "${HOME}/.asdf" ] || . "$HOME/.asdf/asdf.sh"
if [ -n "$LD_LIBRARY_PATH" ]; then
  case ":$LD_LIBRARY_PATH:" in
    *":$HOME/.local/lib:"*) ;;
    *) export LD_LIBRARY_PATH="$HOME/.local/lib:$LD_LIBRARY_PATH" ;;
  esac
else
  export LD_LIBRARY_PATH="$HOME/.local/lib"
fi

if [ "${MACHINE_TYPE}" = "pubnix" ]; then
  if [ "$(hostname)" = "core.envs.net" ] || [ "$(hostname)" = "de1" ]; then
      export TMPDIR="/dev/shm/esperoj"
  else
      export TMPDIR="/tmp/esperoj"
  fi
  if [ ! -d "${TMPDIR}" ]; then
      mkdir -p "${TMPDIR}"/{.cache,.cargo,.npm,tmp}
      chmod 700 "${TMPDIR}"
      rm -rf "${HOME}"/{.cache,.npm,tmp,.cargo}
      ln -vs "${TMPDIR}"/{.cache,.cargo,.npm,tmp} "${HOME}"
  fi
fi

# Don't run code below if shell is non-interactive
case $- in
  *i*)
    if [ -z "$TMUX" ]; then
      tmux attach -t work 2>/dev/null || tmux new-session -s work
      exit
    fi
  ;;
esac
